syntax = "proto3";

package codeindex.v1;

option go_package = "github.com/0x5457/ts-index/api/gen/codeindex/v1;codeindexv1";

service CodeIndex {
  rpc IndexProject(IndexProjectRequest) returns (IndexProjectResponse);
  rpc SearchSemantic(SearchSemanticRequest) returns (SearchSemanticResponse);
  rpc SearchSymbol(SearchSymbolRequest) returns (SearchSymbolResponse);
}

message IndexProjectRequest {
  string path = 1;
}

message IndexProjectResponse {
  int32 indexed_files = 1;
  int32 symbols_upserted = 2;
  int32 chunks_vectorized = 3;
}

message CodeSpan {
  string file = 1;
  int32 start_line = 2;
  int32 end_line = 3;
  string content = 4;
}

message SemanticHit {
  string id = 1;
  string name = 2;
  string kind = 3;
  string signature = 4;
  float score = 5;
  CodeSpan span = 6;
}

message SearchSemanticRequest {
  string query = 1;
  int32 top_k = 2;
  bool include_content = 3;
}

message SearchSemanticResponse {
  repeated SemanticHit hits = 1;
}

message SymbolHit {
  string id = 1;
  string name = 2;
  string kind = 3;
  CodeSpan span = 4;
  string docstring = 5;
}

message SearchSymbolRequest {
  string name = 1;
}

message SearchSymbolResponse {
  repeated SymbolHit hits = 1;
}


