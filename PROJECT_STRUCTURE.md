# é¡¹ç›®æ¨¡å—åŒ–ç»“æ„æ¦‚è§ˆ

æœ¬é¡¹ç›®å·²å®Œæˆç³»ç»Ÿæ€§é‡æ„ï¼Œé‡‡ç”¨çœŸæ­£çš„æ¨¡å—åŒ–Fxä¾èµ–æ³¨å…¥æ¶æ„ã€‚

## ğŸ—ï¸ ç›®å½•ç»“æ„

```
ts-index/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ cmdsfx/                    # å‘½ä»¤æ‰§è¡Œæ¨¡å—
â”‚   â”‚   â””â”€â”€ module.go             # CommandRunner å®ç°
â”‚   â””â”€â”€ ts-index/
â”‚       â”œâ”€â”€ commands/             # CLI å‘½ä»¤å®šä¹‰
â”‚       â””â”€â”€ main.go              # åº”ç”¨å…¥å£ç‚¹
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â””â”€â”€ appfx/               # åº”ç”¨ç»„è£…æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ module.go        # ç»„åˆæ‰€æœ‰æ¨¡å—
â”‚   â”‚       â””â”€â”€ module_test.go   # é›†æˆæµ‹è¯•
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ configfx/            # é…ç½®ç®¡ç†æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ module.go        # é…ç½®æä¾›è€…
â”‚   â”‚       â””â”€â”€ module_test.go   # é…ç½®æµ‹è¯•
â”‚   â”‚
â”‚   â”œâ”€â”€ parser/
â”‚   â”‚   â”œâ”€â”€ parserfx/            # è§£æå™¨æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ module.go        # è§£æå™¨æä¾›è€…
â”‚   â”‚   â”‚   â””â”€â”€ module_test.go   # è§£æå™¨æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ tsparser/            # TypeScriptè§£æå®ç°
â”‚   â”‚   â””â”€â”€ parser.go            # è§£æå™¨æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ embeddings/
â”‚   â”‚   â”œâ”€â”€ embeddingsfx/        # åµŒå…¥æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ module.go        # åµŒå…¥æœåŠ¡æä¾›è€…
â”‚   â”‚   â”œâ”€â”€ api.go               # APIåµŒå…¥å®ç°
â”‚   â”‚   â”œâ”€â”€ local.go             # æœ¬åœ°åµŒå…¥å®ç°
â”‚   â”‚   â””â”€â”€ embedder.go          # åµŒå…¥å™¨æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ storagefx/           # å­˜å‚¨æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ module.go        # å­˜å‚¨æœåŠ¡æä¾›è€…
â”‚   â”‚   â”œâ”€â”€ sqlite/              # SQLiteç¬¦å·å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ sqlvec/              # SQLiteå‘é‡å­˜å‚¨
â”‚   â”‚   â””â”€â”€ storage.go           # å­˜å‚¨æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â”œâ”€â”€ searchfx/            # æœç´¢æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ module.go        # æœç´¢æœåŠ¡æä¾›è€…
â”‚   â”‚   â””â”€â”€ service.go           # æœç´¢æœåŠ¡å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ indexer/
â”‚   â”‚   â”œâ”€â”€ indexerfx/           # ç´¢å¼•å™¨æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ module.go        # ç´¢å¼•å™¨æä¾›è€…
â”‚   â”‚   â”œâ”€â”€ pipeline/            # ç´¢å¼•ç®¡é“å®ç°
â”‚   â”‚   â””â”€â”€ indexer.go           # ç´¢å¼•å™¨æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â”œâ”€â”€ mcpfx/               # MCPæ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ module.go        # MCPæœåŠ¡å™¨æä¾›è€…
â”‚   â”‚   â”œâ”€â”€ client.go            # MCPå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ server.go            # MCPæœåŠ¡å™¨å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ lsp/                     # LSPæ”¯æŒ
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ constants/               # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ util/                    # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ examples/                    # ç¤ºä¾‹é¡¹ç›®
â”œâ”€â”€ scripts/                     # æ„å»ºè„šæœ¬
â”œâ”€â”€ Makefile                     # æ„å»ºé…ç½®
â”œâ”€â”€ go.mod                       # Goæ¨¡å—å®šä¹‰
â”œâ”€â”€ FX_MODULAR_ARCHITECTURE.md  # è¯¦ç»†æ¶æ„æ–‡æ¡£
â””â”€â”€ PROJECT_STRUCTURE.md        # æœ¬æ–‡æ¡£
```

## ğŸ¯ æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

### 1. **ç‹¬ç«‹çš„FxåŒ…**
æ¯ä¸ªåŠŸèƒ½åŸŸéƒ½æœ‰è‡ªå·±çš„ `*fx` åŒ…ï¼š
- `configfx` - é…ç½®ç®¡ç†
- `parserfx` - ä»£ç è§£æ  
- `embeddingsfx` - å‘é‡åµŒå…¥
- `storagefx` - æ•°æ®å­˜å‚¨
- `searchfx` - è¯­ä¹‰æœç´¢
- `indexerfx` - ä»£ç ç´¢å¼•
- `mcpfx` - MCPæœåŠ¡å™¨
- `cmdsfx` - å‘½ä»¤æ‰§è¡Œ
- `appfx` - åº”ç”¨ç»„è£…

### 2. **æ¸…æ™°çš„ä¾èµ–å±‚æ¬¡**
```
é…ç½®å±‚ (configfx)
    â†“
åŸºç¡€æœåŠ¡å±‚ (parserfx, embeddingsfx, storagefx)
    â†“
ä¸šåŠ¡é€»è¾‘å±‚ (searchfx, indexerfx)
    â†“
åº”ç”¨æœåŠ¡å±‚ (mcpfx, cmdsfx)
    â†“
ç»„è£…å±‚ (appfx)
```

### 3. **æµ‹è¯•ç­–ç•¥**
- æ¯ä¸ªæ¨¡å—éƒ½æœ‰ç‹¬ç«‹çš„æµ‹è¯•
- é›†æˆæµ‹è¯•åœ¨ `appfx` å±‚è¿›è¡Œ
- E2Eæµ‹è¯•ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•é…ç½®

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### æ·»åŠ æ–°æ¨¡å—
1. åˆ›å»º `internal/newfeature/newfeaturefx/` ç›®å½•
2. å®ç° `module.go` å’Œ `module_test.go`
3. åœ¨ `appfx/module.go` ä¸­é›†æˆ
4. è¿è¡Œæµ‹è¯•å’Œlintæ£€æŸ¥

### è´¨é‡ä¿è¯
```bash
make lint-fix  # âœ… 0 issues
make test      # âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
go build ./... # âœ… ç¼–è¯‘æˆåŠŸ
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬åº”ç”¨åˆ›å»º
```go
import "github.com/0x5457/ts-index/internal/app/appfx"

app := appfx.NewAppWithConfig(dbPath, embedURL, project)
```

### è‡ªå®šä¹‰æ¨¡å—ç»„åˆ
```go
import (
    "github.com/0x5457/ts-index/internal/config/configfx"
    "github.com/0x5457/ts-index/internal/parser/parserfx"
)

app := fx.New(
    configfx.Module,
    parserfx.Module,
    // ... å…¶ä»–éœ€è¦çš„æ¨¡å—
)
```

### å‘½ä»¤æ‰§è¡Œ
```go
import "github.com/0x5457/ts-index/cmd/cmdsfx"

app := fx.New(
    appfx.Module,
    fx.Supply(/* é…ç½®å‚æ•° */),
    fx.Invoke(func(runner *cmdsfx.CommandRunner) error {
        return runner.RunIndex(ctx, projectPath)
    }),
)
```

## ğŸ“Š ä¼˜åŠ¿æ€»ç»“

âœ… **æ¨¡å—åŒ–** - æ¯ä¸ªåŠŸèƒ½æœ‰ç‹¬ç«‹çš„fxåŒ…  
âœ… **å¯æµ‹è¯•** - å®Œæ•´çš„æµ‹è¯•è¦†ç›–  
âœ… **å¯ç»´æŠ¤** - æ¸…æ™°çš„ä¾èµ–å…³ç³»  
âœ… **å¯æ‰©å±•** - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½  
âœ… **è´¨é‡ä¿è¯** - lintå’Œtestå…¨éƒ¨é€šè¿‡  
âœ… **æ–‡æ¡£å®Œæ•´** - è¯¦ç»†çš„æ¶æ„è¯´æ˜  

è¿™ç§æ¶æ„ä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•æä¾›äº†åšå®çš„åŸºç¡€ã€‚